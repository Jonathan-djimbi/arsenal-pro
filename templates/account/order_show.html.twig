{% extends 'base.html.twig' %}

{% block title %}<title>Mes commandes | Arsenal Pro</title>{% endblock %}

{% block content %}
    {{ render(controller('App\\Controller\\HomeController::banniereShow',{ 'titre': order.reference, 'section' : 0, 'multi' : false })) }}
    <a href="{{ path('app_account_order') }}"><i class="fa-solid fa-arrow-left"></i> Retour vers mes commandes</a>
    <hr><strong></strong>
    <strong>Statut de la commande : </strong>
    <b class="text-success">
    {% set orderPriceFinal = 0 %}
     {% if order.state == 1 %}
            Paiement accepté
        {% elseif order.state == 2 %}
            Préparation en cours
        {% elseif order.state == 3 %}           
            Livraison en cours
        {% elseif order.state == 4 %}           
            Commande livrée
        {% elseif order.state == -1 %}           
            Commande remboursée
    {% endif %}
    </b>
    <br/>
    <strong>Commande passée le :</strong> {{ order.createAt|date('d/m/Y') }}<br/>
    <strong>Référence de ma commande :</strong> <small class="text-dark badge badge-success border_radius_all_15" style="font-size : 80% !important;">{{ order.reference }}</small><br/>
    <strong>Transporteur choisi : </strong><b class="text-primary">{{ order.carriername }}</b><br/>
    {% if promo %}
        <strong class="text-success">Code promo utilisé : {{promo.code}}</strong>
    {% endif %}
    {% if order.pointFideliteUtilise and order.pointFideliteUtilise > 0 %}
        <br/><strong>En tout {{(order.pointFideliteUtilise /10)|round}} points de fidélité utilisés</strong>
    {% endif %}
        {% if order.montantCompteUtilise and order.montantCompteUtilise > 0 %}
        <br/><strong>En tout {{(order.montantCompteUtilise / 100)|number_format(2)}}€ de remise ont été utilisés de votre compte</strong>
    {% endif %}
    {% if order.refundAmount %}
        <br/><strong>VOTRE COMMANDE A ÉTÉ REMBOURSÉE de {{order.refundAmount /100|number_format(2,".","")}}€</strong>
    {% endif %}
    <hr>
    <strong>Détails de cette commande :</strong>
    <br/>
    <br/>
    <section class="details_order">
        {% for product in produits %}
            <div class="details_order_produit border_radius_all box_shadow_all mb-5">
                {% if product.pid %}
                    <div class="details_order_produit_img"><img src="{{ (product.pid.illustration starts with "http") ? '' : '/uploads/'  }}{{ product.pid.illustration }}"></div>
                {% endif %}
                <div class="ml-4 mr-4">
                    <h3>{{ product.product }}</h3>
                    <article>
                        <p>Quantité(s) : <b>x{{ product.quantity }}</b></p>
                        <p>Prix unitaire : <b>{{ (product.price / 100)|number_format(2, ',', '.') }} €</b></p>
                        <p>Prix total : <b>{{ (product.total / 100)|number_format(2, ',', '.') }} €</b></p>
                    </article>
                </div>
            </div>
        {% endfor %}
    </section>
    <hr>
    <div class="text-right">
        <strong>Sous-total :</strong> {{ (order.getTotal / 100)|number_format(2, ',', '.') }} €<br/>
        <strong>Frais de livraison :</strong> {{ (order.carrierprice / 100)|number_format(2, ',', '.') }} €<br/>
        {% set orderPriceFinal = (orderPriceFinal + order.carrierPrice + order.getTotal) %}

        {% if order.pointFideliteUtilise and order.pointFideliteUtilise > 0 %} {# pour remise fidélité #}
            {% set orderPriceFinal = (orderPriceFinal - order.pointFideliteUtilise) %}
        {% endif %}

        {% if order.montantCompteUtilise and order.montantCompteUtilise > 0 %} {# pour remise si client a utilisé l'argent de son compte #}
            {% set orderPriceFinal = (orderPriceFinal - order.montantCompteUtilise) %}
        {% endif %}

        {% if promo %} {# pour remise en euros promo #}
            {% if promo.montantRemise and promo.montantRemise > 0 %}
                {% set orderPriceFinal = (orderPriceFinal - promo.montantRemise) %}
                <strong class="text-success">Remise promo de -{{ ((promo.montantRemise) / 100)|number_format(2, ',', '.') }} €</strong><br/>
            {% endif %}
        {% endif %}
        <strong>Total : </strong> {{ ((orderPriceFinal) / 100)|number_format(2, ',', '.') }} €
    </div>
{% endblock %}